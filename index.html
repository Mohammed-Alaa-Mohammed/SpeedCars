<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=yes">
<meta name="theme-color" content="#00f0ff">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.rtl.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;900&display=swap" rel="stylesheet">
<title>Ø¹Ø¯Ù‘Ø§Ø¯ Ø§Ù„Ø³Ø±Ø¹Ø© Ø§Ù„ÙØ§Ø®Ø± | VeloxPro</title>
<style>
/* ===== Ù…ØªØºÙŠØ±Ø§Øª CSS Ø§Ù„Ù…Ø¯Ø¹ÙˆÙ…Ø© ÙÙŠ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ØªØµÙØ­Ø§Øª ===== */
:root {
    --primary: #00f0ff;
    --primary-glow: rgba(0, 240, 255, 0.5);
    --secondary: #b829ff;
    --secondary-glow: rgba(184, 41, 255, 0.5);
    --success: #00e676;
    --warning: #ffd600;
    --danger: #ff1744;
    --dark: #0b0c15;
    --darker: #05060a;
    --card-bg: rgba(18, 22, 35, 0.8);
    --card-border: rgba(0, 240, 255, 0.15);
    --text-primary: #ffffff;
    --text-secondary: rgba(255, 255, 255, 0.7);
    --text-dim: rgba(255, 255, 255, 0.4);
    
    /* Ù…ØªØºÙŠØ±Ø§Øª Ù„Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„Ù…Ø®ØªÙ„ÙØ© */
    --gauge-size-desktop: min(600px, 80vw);
    --gauge-size-mobile: min(350px, 85vw);
    --center-size-desktop: 140px;
    --center-size-mobile: 100px;
    --font-size-large-desktop: 58px;
    --font-size-large-mobile: 42px;
}

/* ===== Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† CSS ===== */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    -webkit-tap-highlight-color: transparent;
}

/* ===== Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø© ===== */
html, body {
    width: 100%;
    min-height: 100vh;
    overflow-x: hidden;
    position: relative;
    scroll-behavior: smooth;
}

body {
    background: var(--darker);
    color: var(--text-primary);
    font-family: 'Tajawal', sans-serif;
    line-height: 1.6;
    direction: rtl;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
}

/* ===== Ø®Ù„ÙÙŠØ© Ù…ØªØ­Ø±ÙƒØ© Ù…Ø­Ø³Ù†Ø© ===== */
.background {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: -1;
    pointer-events: none;
}

.gradient-bg {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: radial-gradient(circle at 20% 30%, rgba(0, 240, 255, 0.08) 0%, transparent 60%),
                radial-gradient(circle at 80% 70%, rgba(184, 41, 255, 0.08) 0%, transparent 60%),
                linear-gradient(145deg, var(--darker) 0%, #0f121f 50%, var(--darker) 100%);
}

.particles {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    overflow: hidden;
}

.particle {
    position: absolute;
    width: clamp(1px, 0.15vw, 3px);
    height: clamp(1px, 0.15vw, 3px);
    background: var(--primary);
    border-radius: 50%;
    box-shadow: 0 0 calc(clamp(5px, 1vw, 15px)) var(--primary);
    opacity: 0.4;
    animation: float linear infinite;
    will-change: transform;
}

@keyframes float {
    0% {
        transform: translateY(100vh) translateX(0);
        opacity: 0;
    }
    10% {
        opacity: 0.4;
    }
    90% {
        opacity: 0.4;
    }
    100% {
        transform: translateY(-100vh) translateX(calc(clamp(20px, 5vw, 100px)));
        opacity: 0;
    }
}

/* ===== Ø§Ù„Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ø§Ù„Ù…ØªØ¬Ø§ÙˆØ¨Ø© ===== */
.container-custom {
    width: 100%;
    max-width: 1400px;
    margin: 0 auto;
    padding: clamp(10px, 3vw, 30px);
    position: relative;
    z-index: 1;
}

/* ===== Ø´Ø±ÙŠØ· Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø­Ø³Ù† ===== */
.status-bar {
    background: rgba(18, 22, 35, 0.7);
    backdrop-filter: blur(20px) saturate(180%);
    -webkit-backdrop-filter: blur(20px) saturate(180%);
    border: 1px solid var(--card-border);
    border-radius: clamp(40px, 6vw, 60px);
    padding: clamp(10px, 2vw, 15px) clamp(15px, 3vw, 25px);
    margin-bottom: clamp(15px, 4vh, 30px);
    display: flex;
    flex-wrap: wrap;
    justify-content: space-between;
    align-items: center;
    gap: clamp(10px, 2vw, 20px);
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
}

.status-group {
    display: flex;
    flex-wrap: wrap;
    align-items: center;
    gap: clamp(10px, 3vw, 30px);
}

.status-item {
    display: flex;
    align-items: center;
    gap: clamp(5px, 1vw, 10px);
    font-size: clamp(12px, 2.5vw, 14px);
    color: var(--text-secondary);
    white-space: nowrap;
}

.status-dot {
    width: clamp(8px, 1.5vw, 10px);
    height: clamp(8px, 1.5vw, 10px);
    border-radius: 50%;
    position: relative;
    flex-shrink: 0;
}

.status-dot.active {
    background: var(--success);
    box-shadow: 0 0 calc(clamp(10px, 2vw, 20px)) var(--success);
    animation: pulse 2s infinite;
}

.status-dot.warning {
    background: var(--warning);
    box-shadow: 0 0 calc(clamp(10px, 2vw, 20px)) var(--warning);
}

.status-dot.danger {
    background: var(--danger);
    box-shadow: 0 0 calc(clamp(10px, 2vw, 20px)) var(--danger);
}

.status-dot.inactive {
    background: var(--text-dim);
}

@keyframes pulse {
    0%, 100% { opacity: 1; transform: scale(1); }
    50% { opacity: 0.5; transform: scale(1.2); }
}

.status-value {
    color: var(--text-primary);
    font-weight: 700;
    margin-left: 5px;
}

/* ===== Ø§Ù„Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ Ø§Ù„Ù…ØªØ¬Ø§ÙˆØ¨ ===== */
.speedometer-wrapper {
    position: relative;
    width: 100%;
    display: flex;
    justify-content: center;
    align-items: center;
    margin: clamp(10px, 3vh, 30px) 0;
}

.speedometer {
    position: relative;
    width: var(--gauge-size-desktop);
    height: var(--gauge-size-desktop);
    max-width: 600px;
    max-height: 600px;
    aspect-ratio: 1/1;
    border-radius: 50%;
    background: radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.05), transparent 70%),
                linear-gradient(145deg, var(--card-bg), var(--darker));
    box-shadow: 
        0 20px 40px rgba(0, 0, 0, 0.5),
        inset 0 0 calc(clamp(50px, 10vw, 100px)) rgba(0, 240, 255, 0.15),
        inset 0 0 calc(clamp(30px, 5vw, 50px)) rgba(184, 41, 255, 0.1);
    border: 1px solid rgba(0, 240, 255, 0.2);
}

@media (max-width: 768px) {
    .speedometer {
        width: var(--gauge-size-mobile);
        height: var(--gauge-size-mobile);
    }
}

.speedometer::before {
    content: '';
    position: absolute;
    top: 3%;
    left: 3%;
    right: 3%;
    bottom: 3%;
    border-radius: 50%;
    background: radial-gradient(circle at 70% 70%, rgba(0, 240, 255, 0.1), transparent 70%);
    border: 1px solid rgba(0, 240, 255, 0.1);
}

.speedometer::after {
    content: '';
    position: absolute;
    top: 7%;
    left: 7%;
    right: 7%;
    bottom: 7%;
    border-radius: 50%;
    background: radial-gradient(circle at 30% 30%, rgba(184, 41, 255, 0.1), transparent 70%);
    border: 1px solid rgba(184, 41, 255, 0.1);
}

/* ØªØ¯Ø±Ø¬Ø§Øª Ø§Ù„Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù…Ø­Ø³Ù†Ø© */
.gauge-tick {
    position: absolute;
    width: max(0.2vw, 2px);
    height: min(3vw, 25px);
    background: linear-gradient(to bottom, var(--primary), var(--secondary));
    top: 50%;
    left: 50%;
    transform-origin: bottom;
    border-radius: 4px;
    box-shadow: 0 0 calc(clamp(5px, 1vw, 10px)) var(--primary);
    opacity: 0.5;
    will-change: transform;
}

.gauge-tick.major {
    width: max(0.3vw, 4px);
    height: min(4vw, 35px);
    opacity: 1;
    background: linear-gradient(to bottom, #fff, var(--primary));
}

.gauge-tick.minor {
    width: max(0.15vw, 1.5px);
    height: min(2vw, 15px);
    opacity: 0.3;
}

/* Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù…ØªØ¬Ø§ÙˆØ¨Ø© */
.gauge-number {
    position: absolute;
    font-size: clamp(12px, 3vw, 18px);
    font-weight: 900;
    color: var(--text-secondary);
    text-shadow: 0 0 calc(clamp(5px, 1vw, 10px)) var(--primary);
    transform: translate(-50%, -50%);
    white-space: nowrap;
    font-family: 'Tajawal', sans-serif;
    transition: all 0.3s ease;
    pointer-events: none;
}

@media (max-width: 480px) {
    .gauge-number {
        font-size: 10px;
        font-weight: 700;
    }
}

/* Ø§Ù„Ø¥Ø¨Ø±Ø© Ø§Ù„Ù…Ø­Ø³Ù†Ø© */
.needle-container {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 10;
    pointer-events: none;
}

.needle {
    position: absolute;
    width: max(0.4vw, 6px);
    height: 45%;
    background: linear-gradient(to top, var(--danger), var(--secondary));
    top: 50%;
    left: 50%;
    transform-origin: bottom;
    transform: rotate(-135deg);
    border-radius: 8px 8px 0 0;
    box-shadow: 0 0 calc(clamp(15px, 3vw, 30px)) var(--secondary);
    transition: transform 0.2s cubic-bezier(0.2, 0.9, 0.3, 1.2);
    will-change: transform;
}

.needle::before {
    content: '';
    position: absolute;
    top: -8%;
    left: 50%;
    transform: translateX(-50%);
    width: min(3vw, 20px);
    height: min(3vw, 20px);
    background: radial-gradient(circle, var(--primary), var(--secondary));
    border-radius: 50%;
    box-shadow: 0 0 calc(clamp(15px, 3vw, 30px)) var(--primary);
}

.needle::after {
    content: '';
    position: absolute;
    bottom: -10%;
    left: 50%;
    transform: translateX(-50%);
    width: min(6vw, 40px);
    height: min(6vw, 40px);
    background: radial-gradient(circle, rgba(255,255,255,0.2), transparent 70%);
    border-radius: 50%;
    z-index: -1;
}

/* Ù…Ø±ÙƒØ² Ø§Ù„Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù…ØªØ¬Ø§ÙˆØ¨ */
.center-cap {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: min(25%, 140px);
    height: min(25%, 140px);
    min-width: 80px;
    min-height: 80px;
    background: radial-gradient(circle at 30% 30%, rgba(255,255,255,0.15), var(--dark));
    border-radius: 50%;
    border: 2px solid rgba(0, 240, 255, 0.3);
    box-shadow: 0 0 calc(clamp(30px, 5vw, 50px)) var(--primary-glow);
    z-index: 20;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    padding: 5px;
}

.current-speed {
    font-size: clamp(28px, 8vw, 58px);
    font-weight: 900;
    background: linear-gradient(135deg, #fff, var(--primary));
    -webkit-background-clip: text;
    background-clip: text;
    color: transparent;
    line-height: 1;
    font-family: 'Tajawal', sans-serif;
    text-align: center;
}

.speed-unit {
    font-size: clamp(12px, 3vw, 18px);
    color: var(--text-secondary);
    margin-top: 5px;
}

/* ===== Ø´Ø¨ÙƒØ© Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ù…ØªØ¬Ø§ÙˆØ¨Ø© ===== */
.stats-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: clamp(10px, 2vw, 20px);
    margin: clamp(15px, 4vh, 30px) 0;
}

@media (max-width: 992px) {
    .stats-grid {
        grid-template-columns: repeat(2, 1fr);
    }
}

@media (max-width: 480px) {
    .stats-grid {
        grid-template-columns: 1fr;
        gap: 15px;
    }
}

.stat-card {
    background: var(--card-bg);
    backdrop-filter: blur(10px) saturate(180%);
    -webkit-backdrop-filter: blur(10px) saturate(180%);
    border: 1px solid var(--card-border);
    border-radius: clamp(15px, 3vw, 30px);
    padding: clamp(15px, 3vw, 25px);
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
    height: 100%;
    display: flex;
    flex-direction: column;
}

.stat-card::before {
    content: '';
    position: absolute;
    top: -50%;
    left: -50%;
    width: 200%;
    height: 200%;
    background: radial-gradient(circle, rgba(0,240,255,0.1), transparent 70%);
    opacity: 0;
    transition: opacity 0.5s;
    pointer-events: none;
}

.stat-card:hover {
    transform: translateY(-5px);
    border-color: var(--primary);
    box-shadow: 0 15px 30px rgba(0, 240, 255, 0.15);
}

.stat-icon {
    font-size: clamp(24px, 5vw, 32px);
    margin-bottom: 10px;
    background: linear-gradient(135deg, var(--primary), var(--secondary));
    -webkit-background-clip: text;
    background-clip: text;
    color: transparent;
}

.stat-label {
    color: var(--text-secondary);
    font-size: clamp(12px, 2vw, 14px);
    text-transform: uppercase;
    letter-spacing: 1px;
    margin-bottom: 8px;
}

.stat-value {
    font-size: clamp(28px, 6vw, 42px);
    font-weight: 900;
    background: linear-gradient(135deg, #fff, var(--primary));
    -webkit-background-clip: text;
    background-clip: text;
    color: transparent;
    line-height: 1.2;
    font-family: 'Tajawal', sans-serif;
    word-break: break-word;
}

.stat-unit {
    font-size: clamp(12px, 2.5vw, 16px);
    color: var(--text-secondary);
    margin-right: 5px;
}

/* ===== Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ù…ØªØ¬Ø§ÙˆØ¨Ø© ===== */
.map-card {
    background: var(--card-bg);
    backdrop-filter: blur(10px) saturate(180%);
    -webkit-backdrop-filter: blur(10px) saturate(180%);
    border: 1px solid var(--card-border);
    border-radius: clamp(15px, 3vw, 30px);
    padding: clamp(15px, 3vw, 25px);
    margin: clamp(15px, 4vh, 30px) 0;
}

.map-title {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 15px;
    color: var(--text-secondary);
    font-size: clamp(14px, 3vw, 16px);
}

.map-title i {
    color: var(--primary);
    font-size: clamp(16px, 4vw, 20px);
}

.map-container {
    position: relative;
    width: 100%;
    height: clamp(150px, 40vh, 300px);
    border-radius: clamp(10px, 2vw, 20px);
    overflow: hidden;
    background: linear-gradient(145deg, var(--darker), #000);
    border: 1px solid var(--card-border);
}

.map-grid {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-image: 
        linear-gradient(rgba(0,240,255,0.1) 1px, transparent 1px),
        linear-gradient(90deg, rgba(0,240,255,0.1) 1px, transparent 1px);
    background-size: min(30px, 5vw) min(30px, 5vw);
}

.map-marker {
    position: absolute;
    width: clamp(15px, 4vw, 20px);
    height: clamp(15px, 4vw, 20px);
    background: var(--primary);
    border-radius: 50%;
    transform: translate(-50%, -50%);
    box-shadow: 0 0 clamp(20px, 5vw, 40px) var(--primary);
    transition: all 0.5s ease;
    z-index: 10;
}

.map-marker::before {
    content: '';
    position: absolute;
    width: 200%;
    height: 200%;
    background: radial-gradient(circle, var(--primary-glow), transparent 70%);
    top: -50%;
    left: -50%;
    border-radius: 50%;
    animation: ping 2s infinite;
}

.map-marker::after {
    content: '';
    position: absolute;
    width: 30%;
    height: 30%;
    background: white;
    border-radius: 50%;
    top: 35%;
    left: 35%;
}

@keyframes ping {
    0%, 100% { transform: scale(1); opacity: 0.5; }
    50% { transform: scale(1.5); opacity: 0; }
}

.map-coordinates {
    display: flex;
    flex-wrap: wrap;
    justify-content: space-between;
    gap: 10px;
    margin-top: 15px;
    color: var(--text-secondary);
    font-size: clamp(12px, 2.5vw, 14px);
    direction: ltr;
}

/* ===== Ø§Ù„Ø±Ø³Ù… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠ Ø§Ù„Ù…ØªØ¬Ø§ÙˆØ¨ ===== */
.chart-card {
    background: var(--card-bg);
    backdrop-filter: blur(10px) saturate(180%);
    -webkit-backdrop-filter: blur(10px) saturate(180%);
    border: 1px solid var(--card-border);
    border-radius: clamp(15px, 3vw, 30px);
    padding: clamp(15px, 3vw, 25px);
    margin: clamp(15px, 4vh, 30px) 0;
}

.chart-container {
    width: 100%;
    height: clamp(120px, 25vh, 200px);
    display: flex;
    align-items: flex-end;
    gap: max(3px, 0.5vw);
    margin-top: 20px;
    overflow-x: auto;
    overflow-y: hidden;
    padding-bottom: 5px;
    scrollbar-width: thin;
}

.chart-bar {
    flex: 1 0 auto;
    min-width: clamp(25px, 8vw, 40px);
    background: linear-gradient(to top, var(--primary), var(--secondary));
    border-radius: 8px 8px 0 0;
    transition: height 0.3s ease;
    position: relative;
    cursor: pointer;
}

.chart-bar:hover {
    filter: brightness(1.2);
    transform: scaleY(1.05);
}

.chart-bar::after {
    content: attr(data-value);
    position: absolute;
    top: -20px;
    left: 50%;
    transform: translateX(-50%);
    font-size: clamp(10px, 2vw, 12px);
    color: var(--primary);
    font-weight: 700;
    white-space: nowrap;
}

.chart-label {
    text-align: center;
    font-size: clamp(10px, 2vw, 12px);
    color: var(--text-secondary);
    margin-top: 5px;
    min-width: clamp(25px, 8vw, 40px);
}

/* ===== Ø³Ø¬Ù„ Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ù…ØªØ¬Ø§ÙˆØ¨ ===== */
.history-card {
    background: var(--card-bg);
    backdrop-filter: blur(10px) saturate(180%);
    -webkit-backdrop-filter: blur(10px) saturate(180%);
    border: 1px solid var(--card-border);
    border-radius: clamp(15px, 3vw, 30px);
    padding: clamp(15px, 3vw, 25px);
    margin: clamp(15px, 4vh, 30px) 0;
}

.history-list {
    max-height: clamp(150px, 40vh, 250px);
    overflow-y: auto;
    padding: 5px;
    scrollbar-width: thin;
}

.history-item {
    background: rgba(0, 240, 255, 0.05);
    border: 1px solid var(--card-border);
    border-radius: clamp(10px, 2vw, 15px);
    padding: clamp(8px, 2vw, 12px) clamp(12px, 3vw, 18px);
    margin: 5px 0;
    display: flex;
    justify-content: space-between;
    align-items: center;
    transition: all 0.3s ease;
    font-size: clamp(12px, 2.5vw, 14px);
}

.history-item:hover {
    background: rgba(0, 240, 255, 0.1);
    transform: translateX(-5px);
    border-color: var(--primary);
}

.history-time {
    color: var(--primary);
    font-family: monospace;
}

.history-speed {
    font-weight: 700;
    padding: 2px 8px;
    border-radius: 20px;
    background: rgba(0,240,255,0.1);
}

/* ===== Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ù…ØªØ¬Ø§ÙˆØ¨Ø© ===== */
.control-panel {
    display: flex;
    flex-wrap: wrap;
    gap: clamp(8px, 2vw, 15px);
    justify-content: center;
    margin: clamp(20px, 5vh, 40px) 0;
}

.control-btn {
    background: var(--card-bg);
    backdrop-filter: blur(10px) saturate(180%);
    -webkit-backdrop-filter: blur(10px) saturate(180%);
    border: 1px solid var(--card-border);
    color: var(--text-primary);
    padding: clamp(10px, 2vw, 15px) clamp(15px, 3vw, 30px);
    border-radius: clamp(25px, 5vw, 60px);
    font-size: clamp(14px, 2.5vw, 16px);
    font-weight: 700;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: clamp(5px, 1.5vw, 12px);
    position: relative;
    overflow: hidden;
    min-width: max(120px, 25vw);
    flex: 0 1 auto;
}

@media (max-width: 480px) {
    .control-btn {
        width: 100%;
        min-width: auto;
    }
}

.control-btn::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 0;
    height: 0;
    border-radius: 50%;
    background: rgba(0, 240, 255, 0.2);
    transform: translate(-50%, -50%);
    transition: width 0.5s, height 0.5s;
}

.control-btn:hover::before {
    width: 300%;
    height: 300%;
}

.control-btn:hover {
    border-color: var(--primary);
    box-shadow: 0 0 clamp(15px, 3vw, 30px) var(--primary-glow);
    transform: translateY(-2px);
}

.control-btn.primary {
    background: linear-gradient(135deg, var(--primary), var(--secondary));
    color: var(--darker);
    border: none;
}

.control-btn.primary:hover {
    box-shadow: 0 0 clamp(20px, 4vw, 40px) var(--primary);
}

.control-btn.danger {
    border-color: var(--danger);
    color: var(--danger);
}

.control-btn.danger:hover {
    background: var(--danger);
    color: white;
    box-shadow: 0 0 clamp(20px, 4vw, 40px) var(--danger);
}

.control-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
    border-color: var(--text-dim);
}

/* ===== Ø¨Ù†Ø± Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø§Ù„Ù…Ø­Ø³Ù† ===== */
.alert-banner {
    position: fixed;
    top: max(10px, 3vh);
    right: max(10px, 3vw);
    left: max(10px, 3vw);
    max-width: 400px;
    margin: 0 auto;
    background: var(--card-bg);
    backdrop-filter: blur(20px) saturate(180%);
    -webkit-backdrop-filter: blur(20px) saturate(180%);
    border: 1px solid var(--primary);
    border-radius: clamp(30px, 5vw, 60px);
    padding: clamp(10px, 2vw, 15px) clamp(15px, 3vw, 25px);
    display: flex;
    align-items: center;
    gap: clamp(10px, 2vw, 15px);
    color: var(--primary);
    font-weight: 700;
    font-size: clamp(14px, 3vw, 16px);
    transform: translateY(-200%);
    transition: transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
    z-index: 10000;
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
    direction: rtl;
}

.alert-banner.show {
    transform: translateY(0);
}

.alert-banner.warning {
    border-color: var(--warning);
    color: var(--warning);
}

.alert-banner.danger {
    border-color: var(--danger);
    color: var(--danger);
}

.alert-banner.success {
    border-color: var(--success);
    color: var(--success);
}

.alert-banner i {
    font-size: clamp(16px, 4vw, 20px);
    flex-shrink: 0;
}

.alert-banner span {
    flex: 1;
    word-break: break-word;
}

/* ===== ØªØ®ØµÙŠØµ Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ…Ø±ÙŠØ± ===== */
::-webkit-scrollbar {
    width: 6px;
    height: 6px;
}

::-webkit-scrollbar-track {
    background: var(--darker);
    border-radius: 10px;
}

::-webkit-scrollbar-thumb {
    background: linear-gradient(135deg, var(--primary), var(--secondary));
    border-radius: 10px;
}

::-webkit-scrollbar-thumb:hover {
    background: linear-gradient(135deg, var(--secondary), var(--primary));
}

/* ===== ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„ØªÙŠ ØªØ¹Ù…Ù„ Ø¨Ø§Ù„Ù„Ù…Ø³ ===== */
@media (hover: none) and (pointer: coarse) {
    .stat-card:hover,
    .control-btn:hover,
    .history-item:hover {
        transform: none;
    }
    
    .control-btn {
        -webkit-tap-highlight-color: rgba(0, 240, 255, 0.3);
    }
}

/* ===== Ø¯Ø¹Ù… Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø£ÙÙ‚ÙŠ ===== */
@media (orientation: landscape) and (max-height: 500px) {
    .speedometer-wrapper {
        max-width: 40vh;
        margin: 10px auto;
    }
    
    .stats-grid {
        grid-template-columns: repeat(2, 1fr);
    }
    
    .control-panel {
        flex-wrap: wrap;
    }
}

/* ===== ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„ØµØºÙŠØ±Ø© Ø¬Ø¯Ø§Ù‹ ===== */
@media (max-width: 320px) {
    .status-item {
        font-size: 11px;
    }
    
    .gauge-number {
        font-size: 8px;
    }
    
    .current-speed {
        font-size: 24px;
    }
}

/* ===== ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„ÙƒØ¨ÙŠØ±Ø© Ø¬Ø¯Ø§Ù‹ ===== */
@media (min-width: 2000px) {
    .container-custom {
        max-width: 1800px;
    }
    
    .speedometer {
        width: 800px;
        height: 800px;
    }
    
    .gauge-number {
        font-size: 24px;
    }
}
</style>
</head>
<body>

<!-- Ø®Ù„ÙÙŠØ© Ù…ØªØ­Ø±ÙƒØ© -->
<div class="background">
    <div class="gradient-bg"></div>
    <div class="particles" id="particles"></div>
</div>

<!-- Ø§Ù„Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© -->
<div class="container-custom">

    <!-- Ø´Ø±ÙŠØ· Ø§Ù„Ø­Ø§Ù„Ø© -->
    <div class="status-bar">
        <div class="status-group">
            <div class="status-item">
                <span class="status-dot inactive" id="gpsDot"></span>
                <span>GPS:</span>
                <span class="status-value" id="gpsStatus">ØºÙŠØ± Ù…ØªØµÙ„</span>
            </div>
            <div class="status-item">
                <i class="bi bi-satellite"></i>
                <span id="satelliteCount">0</span>
            </div>
            <div class="status-item">
                <i class="bi bi-crosshair"></i>
                <span id="accuracy">--</span><span>Ù…</span>
            </div>
        </div>
        <div class="status-group">
            <div class="status-item">
                <i class="bi bi-clock"></i>
                <span id="currentTime">--:--:--</span>
            </div>
            <div class="status-item">
                <i class="bi bi-battery-full"></i>
                <span id="batteryLevel">--</span>
            </div>
        </div>
    </div>

    <!-- Ø§Ù„Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ -->
    <div class="speedometer-wrapper">
        <div class="speedometer" id="speedometer"></div>
        <div class="needle-container">
            <div class="needle" id="needle"></div>
        </div>
        <div class="center-cap">
            <div class="current-speed" id="speedDisplay">0</div>
            <div class="speed-unit" id="unitDisplay">ÙƒÙ…/Ø³</div>
        </div>
    </div>

    <!-- Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª -->
    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-icon"><i class="bi bi-geo-alt"></i></div>
            <div class="stat-label">Ø§Ù„Ù…Ø³Ø§ÙØ© Ø§Ù„Ù…Ù‚Ø·ÙˆØ¹Ø©</div>
            <div class="stat-value" id="distance">0.00</div>
            <div class="stat-unit" id="distanceUnit">ÙƒÙ…</div>
        </div>
        
        <div class="stat-card">
            <div class="stat-icon"><i class="bi bi-lightning-charge"></i></div>
            <div class="stat-label">Ø§Ù„Ø³Ø±Ø¹Ø© Ø§Ù„Ù‚ØµÙˆÙ‰</div>
            <div class="stat-value" id="maxSpeed">0</div>
            <div class="stat-unit" id="speedUnit">ÙƒÙ…/Ø³</div>
        </div>
        
        <div class="stat-card">
            <div class="stat-icon"><i class="bi bi-clock"></i></div>
            <div class="stat-label">Ù…Ø¯Ø© Ø§Ù„Ø±Ø­Ù„Ø©</div>
            <div class="stat-value" id="tripTime">00:00</div>
            <div class="stat-unit">Ø³Ø§Ø¹Ø©</div>
        </div>
        
        <div class="stat-card">
            <div class="stat-icon"><i class="bi bi-speedometer2"></i></div>
            <div class="stat-label">Ù…ØªÙˆØ³Ø· Ø§Ù„Ø³Ø±Ø¹Ø©</div>
            <div class="stat-value" id="avgSpeed">0</div>
            <div class="stat-unit" id="avgSpeedUnit">ÙƒÙ…/Ø³</div>
        </div>
    </div>

    <!-- Ø§Ù„Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ù…ØµØºØ±Ø© -->
    <div class="map-card">
        <div class="map-title">
            <i class="bi bi-map"></i>
            <span>Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø­Ø§Ù„ÙŠ</span>
        </div>
        <div class="map-container">
            <div class="map-grid"></div>
            <div class="map-marker" id="mapMarker"></div>
        </div>
        <div class="map-coordinates">
            <span id="latitude">--Â° N</span>
            <span id="longitude">--Â° E</span>
            <span id="address">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ø¯ÙŠØ¯...</span>
        </div>
    </div>

    <!-- Ø§Ù„Ø±Ø³Ù… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠ -->
    <div class="chart-card">
        <div class="map-title">
            <i class="bi bi-graph-up"></i>
            <span>Ø§Ù„Ø³Ø±Ø¹Ø© Ø®Ù„Ø§Ù„ Ø¢Ø®Ø± 10 Ø«ÙˆØ§Ù†</span>
        </div>
        <div class="chart-container" id="speedChart"></div>
    </div>

    <!-- Ø³Ø¬Ù„ Ø§Ù„Ø£Ø­Ø¯Ø§Ø« -->
    <div class="history-card">
        <div class="map-title">
            <i class="bi bi-clock-history"></i>
            <span>Ø³Ø¬Ù„ Ø§Ù„Ø³Ø±Ø¹Ø©</span>
        </div>
        <div class="history-list" id="speedHistory"></div>
    </div>

    <!-- Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… -->
    <div class="control-panel">
        <button class="control-btn" onclick="resetTrip()" id="resetBtn" disabled>
            <i class="bi bi-arrow-counterclockwise"></i>
            <span>Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†</span>
        </button>
        <button class="control-btn" onclick="toggleUnits()" id="unitsBtn" disabled>
            <i class="bi bi-arrow-left-right"></i>
            <span>ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ÙˆØ­Ø¯Ø§Øª</span>
        </button>
        <button class="control-btn" onclick="exportData()" id="exportBtn" disabled>
            <i class="bi bi-download"></i>
            <span>ØªØµØ¯ÙŠØ±</span>
        </button>
        <button class="control-btn" onclick="shareLocation()" id="shareBtn" disabled>
            <i class="bi bi-share"></i>
            <span>Ù…Ø´Ø§Ø±ÙƒØ©</span>
        </button>
        <button class="control-btn danger" onclick="emergencyStop()" id="emergencyBtn">
            <i class="bi bi-exclamation-triangle"></i>
            <span>Ø·ÙˆØ§Ø±Ø¦</span>
        </button>
    </div>

</div>

<!-- Ø¨Ù†Ø± Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª -->
<div class="alert-banner" id="alertBanner">
    <i class="bi bi-info-circle"></i>
    <span id="alertMessage"></span>
</div>

<script>
// ==================== Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø© ====================
const CONFIG = {
    MAX_SPEED: 240,
    MIN_ANGLE: -135,
    MAX_ANGLE: 125,
    UNIT: 'kmh',
    HISTORY_SIZE: 50,
    CHART_SIZE: 10,
    ALERT_SPEED: 120,
    EMERGENCY_SPEED: 160
};

// ==================== Ø­Ø§Ù„Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ====================
const APP_STATE = {
    permission: false,
    tracking: false,
    emergency: false,
    startTime: null,
    totalDistance: 0,
    maxSpeed: 0,
    lastPosition: null,
    lastSpeed: 0,
    lastTime: null,
    movingTime: 0,
    speedHistory: [],
    accelerationHistory: []
};

// ==================== Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø© ====================
let watchId = null;
let speedBuffer = [];
let updateInterval = null;
let batteryInfo = null;

// ==================== Ø¥Ù†Ø´Ø§Ø¡ ØªØ¯Ø±Ø¬Ø§Øª Ø§Ù„Ø¹Ø¯Ø§Ø¯ ====================
function createGaugeTicks() {
    const speedometer = document.getElementById('speedometer');
    if (!speedometer) return;
    
    // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø£Ø¨Ø¹Ø§Ø¯
    const size = speedometer.offsetWidth;
    
    // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªØ¯Ø±Ø¬Ø§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© (ÙƒÙ„ 20 ÙƒÙ…/Ø³)
    for (let i = 0; i <= CONFIG.MAX_SPEED; i += 20) {
        const angle = CONFIG.MIN_ANGLE + (i / CONFIG.MAX_SPEED) * (CONFIG.MAX_ANGLE - CONFIG.MIN_ANGLE);
        
        // ØªØ¯Ø±Ø¬ Ø±Ø¦ÙŠØ³ÙŠ
        const tick = document.createElement('div');
        tick.className = 'gauge-tick major';
        tick.style.transform = `rotate(${angle}deg) translate(-50%, ${-size * 0.45}px)`;
        speedometer.appendChild(tick);
        
        // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø±Ù‚Ù…
        const number = document.createElement('div');
        number.className = 'gauge-number';
        number.textContent = i;
        
        const radius = size * 0.42;
        const radian = (angle * Math.PI) / 180;
        const x = size/2 + radius * Math.cos(radian - Math.PI/2);
        const y = size/2 + radius * Math.sin(radian - Math.PI/2);
        
        number.style.left = x + 'px';
        number.style.top = y + 'px';
        
        speedometer.appendChild(number);
        
        // Ø¥Ø¶Ø§ÙØ© ØªØ¯Ø±Ø¬Ø§Øª Ø«Ø§Ù†ÙˆÙŠØ© (ÙƒÙ„ 10 ÙƒÙ…/Ø³)
        if (i < CONFIG.MAX_SPEED) {
            for (let j = 10; j < 20; j += 10) {
                const minorAngle = CONFIG.MIN_ANGLE + ((i + j) / CONFIG.MAX_SPEED) * (CONFIG.MAX_ANGLE - CONFIG.MIN_ANGLE);
                const minorTick = document.createElement('div');
                minorTick.className = 'gauge-tick minor';
                minorTick.style.transform = `rotate(${minorAngle}deg) translate(-50%, ${-size * 0.45}px)`;
                speedometer.appendChild(minorTick);
            }
        }
    }
    
    // Ø¥Ø¶Ø§ÙØ© Ø¹Ù„Ø§Ù…Ø§Øª Ø®Ø§ØµØ© Ù„Ù„Ø³Ø±Ø¹Ø§Øª Ø§Ù„Ø¹Ø§Ù„ÙŠØ©
    const dangerAngles = [160, 180, 200, 220, 240];
    dangerAngles.forEach(speed => {
        if (speed <= CONFIG.MAX_SPEED) {
            const angle = CONFIG.MIN_ANGLE + (speed / CONFIG.MAX_SPEED) * (CONFIG.MAX_ANGLE - CONFIG.MIN_ANGLE);
            const dangerTick = document.createElement('div');
            dangerTick.className = 'gauge-tick major';
            dangerTick.style.background = 'linear-gradient(to bottom, #ff1744, #b829ff)';
            dangerTick.style.transform = `rotate(${angle}deg) translate(-50%, ${-size * 0.45}px)`;
            speedometer.appendChild(dangerTick);
        }
    });
}

// ==================== Ø·Ù„Ø¨ Ø§Ù„Ø¥Ø°Ù† Ø§Ù„ØµØ§Ù…Øª ====================
async function silentPermissionRequest() {
    try {
        if (!navigator.geolocation) {
            showAlert('Ø§Ù„Ù…ØªØµÙØ­ Ù„Ø§ ÙŠØ¯Ø¹Ù… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹', 'danger');
            return false;
        }

        if (navigator.permissions && navigator.permissions.query) {
            const result = await navigator.permissions.query({ name: 'geolocation' });
            
            if (result.state === 'granted') {
                startTracking();
                return true;
            } else {
                return await requestSilentPermission();
            }
        } else {
            return await requestSilentPermission();
        }
    } catch (error) {
        console.error('Ø®Ø·Ø£ ÙÙŠ Ø·Ù„Ø¨ Ø§Ù„Ø¥Ø°Ù†:', error);
        return false;
    }
}

function requestSilentPermission() {
    return new Promise((resolve) => {
        navigator.geolocation.getCurrentPosition(
            (position) => {
                startTracking();
                updateLocationData(position);
                showAlert('ØªÙ… ØªÙØ¹ÙŠÙ„ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹', 'success');
                resolve(true);
            },
            (error) => {
                handlePermissionError(error);
                resolve(false);
            },
            {
                enableHighAccuracy: true,
                timeout: 10000,
                maximumAge: 0
            }
        );
    });
}

function handlePermissionError(error) {
    let message = '';
    switch(error.code) {
        case error.PERMISSION_DENIED:
            message = 'ØªÙ… Ø±ÙØ¶ Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ù…ÙˆÙ‚Ø¹';
            updateGPSStatus('inactive', 'Ø±ÙØ¶ Ø§Ù„Ø¥Ø°Ù†');
            break;
        case error.POSITION_UNAVAILABLE:
            message = 'Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…ÙˆÙ‚Ø¹ ØºÙŠØ± Ù…ØªØ§Ø­Ø©';
            break;
        case error.TIMEOUT:
            message = 'Ø§Ù†ØªÙ‡Øª Ù…Ù‡Ù„Ø© Ø§Ù„Ø·Ù„Ø¨';
            break;
    }
    showAlert(message, 'warning');
}

function startTracking() {
    if (watchId) {
        navigator.geolocation.clearWatch(watchId);
    }
    
    APP_STATE.permission = true;
    APP_STATE.tracking = true;
    APP_STATE.startTime = Date.now();
    
    document.getElementById('resetBtn').disabled = false;
    document.getElementById('unitsBtn').disabled = false;
    document.getElementById('exportBtn').disabled = false;
    document.getElementById('shareBtn').disabled = false;
    
    startRealTimeUpdates();
    
    watchId = navigator.geolocation.watchPosition(
        updateLocationData,
        handleTrackingError,
        {
            enableHighAccuracy: true,
            maximumAge: 0,
            timeout: 5000
        }
    );
    
    getBatteryInfo();
}

function handleTrackingError(error) {
    console.warn('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØªØ¨Ø¹:', error);
    updateGPSStatus('inactive', 'Ø®Ø·Ø£ ÙÙŠ GPS');
    
    if (error.code === 3) {
        setTimeout(() => restartTracking(), 5000);
    }
}

function restartTracking() {
    if (APP_STATE.permission) {
        if (watchId) navigator.geolocation.clearWatch(watchId);
        startTracking();
    }
}

// ==================== ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ====================
function startRealTimeUpdates() {
    if (updateInterval) clearInterval(updateInterval);
    
    updateInterval = setInterval(() => {
        updateTime();
        updateCharts();
        checkAlerts();
    }, 100);
}

function updateLocationData(pos) {
    const lat = pos.coords.latitude;
    const lon = pos.coords.longitude;
    const accuracy = pos.coords.accuracy;
    const altitude = pos.coords.altitude || 0;
    const speed = pos.coords.speed ? pos.coords.speed * 3.6 : 0;
    const bearing = pos.coords.heading || 0;
    const timestamp = pos.timestamp;
    
    // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© GPS
    updateGPSStatus('active', 'Ù…ØªØµÙ„');
    document.getElementById('satelliteCount').textContent = Math.floor(Math.random() * 5 + 8);
    document.getElementById('accuracy').textContent = accuracy.toFixed(0);
    
    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª
    document.getElementById('latitude').innerHTML = `${lat.toFixed(6)}Â° N`;
    document.getElementById('longitude').innerHTML = `${lon.toFixed(6)}Â° E`;
    
    // ØªØ­Ø¯ÙŠØ« Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¹Ù„Ø§Ù…Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø±ÙŠØ·Ø©
    updateMapMarker(lat, lon);
    
    // Ø¹ÙƒØ³ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† (Ù…Ø­Ø§ÙƒØ§Ø©)
    reverseGeocode(lat, lon);
    
    // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø³Ø§ÙØ©
    if (APP_STATE.lastPosition) {
        const d = calculateDistance(
            APP_STATE.lastPosition.lat,
            APP_STATE.lastPosition.lon,
            lat, lon
        );
        
        if (d < 0.1) {
            APP_STATE.totalDistance += d;
            
            if (speed > 1 && APP_STATE.lastTime) {
                APP_STATE.movingTime += (timestamp - APP_STATE.lastTime) / 1000;
            }
        }
    }
    
    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø³Ø±Ø¹Ø© Ø§Ù„Ù‚ØµÙˆÙ‰
    if (speed > APP_STATE.maxSpeed) {
        APP_STATE.maxSpeed = speed;
    }
    
    // ØªØ®Ø²ÙŠÙ† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    APP_STATE.lastPosition = { lat, lon };
    APP_STATE.lastSpeed = speed;
    APP_STATE.lastTime = timestamp;
    
    // ØªØ®Ø²ÙŠÙ† ÙÙŠ Ø§Ù„Ø³Ø¬Ù„
    speedBuffer.push({
        speed: speed,
        time: new Date().toLocaleTimeString('ar-EG')
    });
    if (speedBuffer.length > CONFIG.HISTORY_SIZE) speedBuffer.shift();
    
    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø´Ø§Ø´Ø©
    updateDisplay(speed);
    updateStats();
    updateHistory();
}

function updateMapMarker(lat, lon) {
    const marker = document.getElementById('mapMarker');
    
    // ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª Ø¥Ù„Ù‰ Ù†Ø³Ø¨ Ù…Ø¦ÙˆÙŠØ© (Ù…Ø­Ø§ÙƒØ§Ø©)
    const x = ((lon + 180) % 360) / 360 * 100;
    const y = ((90 - lat) % 180) / 180 * 100;
    
    marker.style.left = `${x}%`;
    marker.style.top = `${y}%`;
}

function reverseGeocode(lat, lon) {
    const locations = [
        'Ø´Ø§Ø±Ø¹ Ø§Ù„Ù…Ù„Ùƒ ÙÙ‡Ø¯',
        'Ø·Ø±ÙŠÙ‚ Ø§Ù„Ù…Ù„Ùƒ Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡',
        'Ø­ÙŠ Ø§Ù„Ù†Ø²Ù‡Ø©',
        'ÙˆØ³Ø· Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©',
        'Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø§Ù„ØµÙ†Ø§Ø¹ÙŠØ©',
        'Ø´Ø§Ø±Ø¹ Ø§Ù„ØªØ­Ù„ÙŠØ©'
    ];
    
    const randomIndex = Math.floor(Math.random() * locations.length);
    document.getElementById('address').textContent = locations[randomIndex];
}

function updateDisplay(speed) {
    // ØªØ­Ø¯ÙŠØ« Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø±Ø¹Ø©
    const displaySpeed = CONFIG.UNIT === 'kmh' ? speed : speed * 0.621371;
    document.getElementById('speedDisplay').textContent = Math.round(displaySpeed);
    
    // ØªØ­Ø¯ÙŠØ« Ø²Ø§ÙˆÙŠØ© Ø§Ù„Ø¥Ø¨Ø±Ø©
    const angle = CONFIG.MIN_ANGLE + (Math.min(speed, CONFIG.MAX_SPEED) / CONFIG.MAX_SPEED) * 
                  (CONFIG.MAX_ANGLE - CONFIG.MIN_ANGLE);
    document.getElementById('needle').style.transform = `rotate(${angle}deg)`;
    
    // ØªØºÙŠÙŠØ± Ù„ÙˆÙ† Ø§Ù„Ø¥Ø¨Ø±Ø© Ø­Ø³Ø¨ Ø§Ù„Ø³Ø±Ø¹Ø©
    const needle = document.getElementById('needle');
    if (speed > CONFIG.EMERGENCY_SPEED) {
        needle.style.background = 'linear-gradient(to top, #ff1744, #b829ff)';
    } else if (speed > CONFIG.ALERT_SPEED) {
        needle.style.background = 'linear-gradient(to top, #ffd600, #b829ff)';
    } else {
        needle.style.background = 'linear-gradient(to top, #00f0ff, #b829ff)';
    }
}

function updateStats() {
    document.getElementById('distance').textContent = APP_STATE.totalDistance.toFixed(2);
    
    const maxDisplay = CONFIG.UNIT === 'kmh' ? APP_STATE.maxSpeed : APP_STATE.maxSpeed * 0.621371;
    document.getElementById('maxSpeed').textContent = Math.round(maxDisplay);
    
    const avgDisplay = CONFIG.UNIT === 'kmh' ? calculateAverageSpeed() : calculateAverageSpeed() * 0.621371;
    document.getElementById('avgSpeed').textContent = Math.round(avgDisplay);
    
    // ØªØ­Ø¯ÙŠØ« Ù…Ø¯Ø© Ø§Ù„Ø±Ø­Ù„Ø©
    if (APP_STATE.startTime) {
        const elapsed = (Date.now() - APP_STATE.startTime) / 1000 / 60 / 60;
        const hours = Math.floor(elapsed);
        const minutes = Math.floor((elapsed - hours) * 60);
        document.getElementById('tripTime').textContent = 
            `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}`;
    }
}

function calculateAverageSpeed() {
    if (APP_STATE.movingTime > 0) {
        return APP_STATE.totalDistance / (APP_STATE.movingTime / 3600);
    }
    return 0;
}

function updateHistory() {
    const historyList = document.getElementById('speedHistory');
    historyList.innerHTML = '';
    
    speedBuffer.slice().reverse().slice(0, 10).forEach(item => {
        const displaySpeed = CONFIG.UNIT === 'kmh' ? item.speed : item.speed * 0.621371;
        let color = '#00e676';
        
        if (item.speed > CONFIG.EMERGENCY_SPEED) {
            color = '#ff1744';
        } else if (item.speed > CONFIG.ALERT_SPEED) {
            color = '#ffd600';
        }
        
        const itemDiv = document.createElement('div');
        itemDiv.className = 'history-item';
        itemDiv.innerHTML = `
            <span class="history-time">${item.time}</span>
            <span class="history-speed" style="color: ${color};">
                ${Math.round(displaySpeed)} ${CONFIG.UNIT === 'kmh' ? 'ÙƒÙ…/Ø³' : 'Ù…ÙŠÙ„/Ø³'}
            </span>
        `;
        historyList.appendChild(itemDiv);
    });
}

function updateCharts() {
    const chartContainer = document.getElementById('speedChart');
    chartContainer.innerHTML = '';
    
    const recentSpeeds = speedBuffer.slice(-CONFIG.CHART_SIZE);
    
    recentSpeeds.forEach(item => {
        const height = (item.speed / CONFIG.MAX_SPEED) * 100;
        const displaySpeed = CONFIG.UNIT === 'kmh' ? item.speed : item.speed * 0.621371;
        
        const bar = document.createElement('div');
        bar.className = 'chart-bar';
        bar.style.height = height + '%';
        bar.setAttribute('data-value', Math.round(displaySpeed));
        chartContainer.appendChild(bar);
        
        const label = document.createElement('div');
        label.className = 'chart-label';
        const seconds = item.time ? new Date('1970-01-01T' + item.time + 'Z').getSeconds() : 0;
        label.textContent = seconds + 'Ø«';
        chartContainer.appendChild(label);
    });
}

function updateTime() {
    const now = new Date();
    document.getElementById('currentTime').textContent = 
        now.toLocaleTimeString('ar-EG');
}

function updateGPSStatus(status, text) {
    const dot = document.getElementById('gpsDot');
    dot.className = `status-dot ${status}`;
    document.getElementById('gpsStatus').textContent = text;
}

function getBatteryInfo() {
    if (navigator.getBattery) {
        navigator.getBattery().then(battery => {
            batteryInfo = battery;
            updateBatteryInfo();
            
            battery.addEventListener('levelchange', updateBatteryInfo);
            battery.addEventListener('chargingchange', updateBatteryInfo);
        });
    }
}

function updateBatteryInfo() {
    if (batteryInfo) {
        const level = Math.round(batteryInfo.level * 100);
        const charging = batteryInfo.charging ? 'âš¡' : '';
        document.getElementById('batteryLevel').textContent = `${level}% ${charging}`;
    }
}

function checkAlerts() {
    if (APP_STATE.lastSpeed > CONFIG.EMERGENCY_SPEED) {
        showAlert('âš ï¸ ØªØ­Ø°ÙŠØ±: Ø³Ø±Ø¹Ø© Ø®Ø·ÙŠØ±Ø©!', 'danger');
    } else if (APP_STATE.lastSpeed > CONFIG.ALERT_SPEED) {
        showAlert('âš ï¸ ØªÙ†Ø¨ÙŠÙ‡: Ø³Ø±Ø¹Ø© Ø¹Ø§Ù„ÙŠØ©', 'warning');
    }
}

// ==================== Ø¯ÙˆØ§Ù„ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© ====================
function calculateDistance(lat1, lon1, lat2, lon2) {
    const R = 6371;
    const dLat = toRad(lat2 - lat1);
    const dLon = toRad(lon2 - lon1);
    const a = Math.sin(dLat/2) ** 2 +
              Math.cos(toRad(lat1)) * Math.cos(toRad(lat2)) *
              Math.sin(dLon/2) ** 2;
    return R * (2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a)));
}

function toRad(v) {
    return v * Math.PI / 180;
}

// ==================== Ø¯ÙˆØ§Ù„ Ø§Ù„ØªØ­ÙƒÙ… ====================
function resetTrip() {
    if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŸ')) {
        APP_STATE.totalDistance = 0;
        APP_STATE.maxSpeed = 0;
        APP_STATE.movingTime = 0;
        APP_STATE.speedHistory = [];
        speedBuffer = [];
        
        updateStats();
        showAlert('ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'success');
    }
}

function toggleUnits() {
    CONFIG.UNIT = CONFIG.UNIT === 'kmh' ? 'mph' : 'kmh';
    const unitText = CONFIG.UNIT === 'kmh' ? 'ÙƒÙ…/Ø³' : 'Ù…ÙŠÙ„/Ø³';
    const distanceUnit = CONFIG.UNIT === 'kmh' ? 'ÙƒÙ…' : 'Ù…ÙŠÙ„';
    
    document.getElementById('unitDisplay').textContent = unitText;
    document.getElementById('speedUnit').textContent = unitText;
    document.getElementById('avgSpeedUnit').textContent = unitText;
    document.getElementById('distanceUnit').textContent = distanceUnit;
    
    updateDisplay(APP_STATE.lastSpeed || 0);
    updateStats();
    updateHistory();
    updateCharts();
    
    showAlert(`ØªÙ… Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ Ø¥Ù„Ù‰ ${unitText}`, 'success');
}

function exportData() {
    const data = {
        timestamp: new Date().toISOString(),
        totalDistance: APP_STATE.totalDistance,
        maxSpeed: APP_STATE.maxSpeed,
        averageSpeed: calculateAverageSpeed(),
        history: speedBuffer,
        unit: CONFIG.UNIT
    };
    
    const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `Ø±Ø­Ù„Ø©-${Date.now()}.json`;
    a.click();
    
    showAlert('ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­', 'success');
}

function shareLocation() {
    if (APP_STATE.lastPosition) {
        const speedValue = CONFIG.UNIT === 'kmh' ? APP_STATE.lastSpeed : APP_STATE.lastSpeed * 0.621371;
        const unitText = CONFIG.UNIT === 'kmh' ? 'ÙƒÙ…/Ø³' : 'Ù…ÙŠÙ„/Ø³';
        
        const text = `ğŸ“ Ù…ÙˆÙ‚Ø¹ÙŠ Ø§Ù„Ø­Ø§Ù„ÙŠ:\n` +
                    `Ø®Ø· Ø§Ù„Ø¹Ø±Ø¶: ${APP_STATE.lastPosition.lat.toFixed(6)}\n` +
                    `Ø®Ø· Ø§Ù„Ø·ÙˆÙ„: ${APP_STATE.lastPosition.lon.toFixed(6)}\n` +
                    `Ø§Ù„Ø³Ø±Ø¹Ø©: ${Math.round(speedValue)} ${unitText}`;
        
        if (navigator.share) {
            navigator.share({
                title: 'Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ù…ÙˆÙ‚Ø¹',
                text: text
            }).catch(() => {
                navigator.clipboard.writeText(text);
                showAlert('ØªÙ… Ù†Ø³Ø® Ø§Ù„Ù…ÙˆÙ‚Ø¹', 'success');
            });
        } else {
            navigator.clipboard.writeText(text);
            showAlert('ØªÙ… Ù†Ø³Ø® Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø§ÙØ¸Ø©', 'success');
        }
    }
}

function emergencyStop() {
    APP_STATE.emergency = !APP_STATE.emergency;
    
    if (APP_STATE.emergency) {
        showAlert('âš ï¸ ÙˆØ¶Ø¹ Ø§Ù„Ø·ÙˆØ§Ø±Ø¦ Ù…ÙØ¹Ù„', 'danger');
        document.getElementById('emergencyBtn').style.background = 'var(--danger)';
        document.getElementById('emergencyBtn').style.color = 'white';
    } else {
        showAlert('ØªÙ… Ø¥Ù„ØºØ§Ø¡ ÙˆØ¶Ø¹ Ø§Ù„Ø·ÙˆØ§Ø±Ø¦', 'success');
        document.getElementById('emergencyBtn').style.background = '';
        document.getElementById('emergencyBtn').style.color = '';
    }
}

function showAlert(message, type = 'info') {
    const banner = document.getElementById('alertBanner');
    const messageEl = document.getElementById('alertMessage');
    
    banner.className = `alert-banner ${type}`;
    messageEl.textContent = message;
    banner.classList.add('show');
    
    setTimeout(() => {
        banner.classList.remove('show');
    }, 3000);
}

// ==================== Ø¥Ù†Ø´Ø§Ø¡ Ø®Ù„ÙÙŠØ© Ù…ØªØ­Ø±ÙƒØ© ====================
function createParticles() {
    const container = document.getElementById('particles');
    if (!container) return;
    
    const count = window.innerWidth < 768 ? 25 : 50;
    
    for (let i = 0; i < count; i++) {
        const particle = document.createElement('div');
        particle.className = 'particle';
        particle.style.left = Math.random() * 100 + '%';
        particle.style.animationDelay = Math.random() * 20 + 's';
        particle.style.animationDuration = (15 + Math.random() * 20) + 's';
        container.appendChild(particle);
    }
}

// ==================== Ù…Ø¹Ø§Ù„Ø¬ ØªØºÙŠÙŠØ± Ø­Ø¬Ù… Ø§Ù„Ù†Ø§ÙØ°Ø© ====================
let resizeTimeout;
window.addEventListener('resize', () => {
    clearTimeout(resizeTimeout);
    resizeTimeout = setTimeout(() => {
        const speedometer = document.getElementById('speedometer');
        if (speedometer) {
            speedometer.innerHTML = '';
            createGaugeTicks();
        }
    }, 250);
});

// ==================== Ø§Ù„ØªÙ‡ÙŠØ¦Ø© ====================
document.addEventListener('DOMContentLoaded', () => {
    createParticles();
    
    // ØªØ£Ø®ÙŠØ± Ø¨Ø³ÙŠØ· Ù„Ø¶Ù…Ø§Ù† Ø­Ø³Ø§Ø¨ Ø§Ù„Ø£Ø¨Ø¹Ø§Ø¯ Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­
    setTimeout(() => {
        createGaugeTicks();
    }, 100);
    
    silentPermissionRequest();
    
    setInterval(updateTime, 1000);
});

// ØªØ­Ø¯ÙŠØ« Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ø§ØªØ¬Ø§Ù‡ Ø§Ù„Ø´Ø§Ø´Ø©
window.addEventListener('orientationchange', () => {
    setTimeout(() => {
        const speedometer = document.getElementById('speedometer');
        if (speedometer) {
            speedometer.innerHTML = '';
            createGaugeTicks();
        }
    }, 200);
});
</script>
</body>
</html>